<!doctype html>
<html class="no-js" lang="en-US">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, minimal-ui">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<title>雲端農場：快易購</title>
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.4/jquery.mobile-1.4.4.min.css" />
<link rel="apple-touch-startup-image" href="img/splash.png" />
<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="http://code.jquery.com/mobile/1.4.4/jquery.mobile-1.4.4.min.js"></script>
<link rel="stylesheet" type="text/css" href="style.css" />
<style type="text/css">#splash{background-image: url(splash.png)}</style>
</head>
<body>
<div data-role="page" data-theme="b" id="splash">
	<div class="splash">
	<!--
		<div class="logoframe">
			<h1>AgriCloud</h1>
			<p>新鮮水果快易購</p>
		</div>
		-->
	</div>
</div>
<div data-role="page" data-theme="b" id="home">
	<div data-role="header" data-position="fixed" data-theme="b">
		<a id="btnGoToDashboard" href="#home" data-icon="home" data-iconpos="notext">回到首頁</a>
		<h1>商品</h1>
	</div>
	<div data-role="main" class="ui-content">
		<img id='product_image' src="about:blank" alt="product" />
		<h3 id='product_name'></h3>
		<p id='product_descript'></p>
		<p>庫存箱數: <span id='product_stockQuantity'>0</span></p>
		<p>單價: <span id='product_price'>0</span></p>
		<fieldset data-role="controlgroup" data-type="horizontal">
	        <label for="select-more-1a" class="ui-hidden-accessible">More</label>
	        <select name="order_quantity" id="order_quantity">
	            <option value="">數量</option>
	        </select>
	        <a href="#order" class="ui-btn ui-corner-all">加入購物車</a>

	    </fieldset>
	</div>
	<div data-role="footer" data-position="fixed">
		<div data-role="navbar">
			<ul>
				<li><a href="#home" data-action="announce" data-icon="home">商品訂購</a></li>
				<li><a href="#order" data-action="contact" data-icon="star">訂單查詢</a></li>
				<li><a href="#home" data-action="information" data-icon="info">履歷</a></li>
				<li><a href="#contact" data-action="about" data-icon="grid">聯絡</a></li>
			</ul>
		</div><!-- /navbar -->
	</div>
</div>
<div data-role="page" data-theme="b" id="order">
	<div data-role="header" data-position="fixed" data-theme="b">
		<a href="#home" data-icon="back" data-iconpos="notext">返回</a>
		<h1>訂單</h1>
	</div>
	<div data-role="content">
		<form id='orderStatusQueryForm' method="post" action="/order/status">
			<div data-role="fieldcontain">
	         <label for="email">Email:</label>
	         <input type="email" name="email" id="email" value="buyer@gmail.com" />
			</div>
			<div data-role="fieldcontain">
	         <label for="orderId">Number:</label>
	         <input type="number" name="orderId" id="orderId" value="1111" />
			</div>
			<fieldset class="ui-grid-a">
				<div class="ui-block-a"><button type="submit" data-theme="d">Cancel</button></div>
				<div class="ui-block-b"><button type="submit" data-theme="a">Submit</button></div>
	    </fieldset>
		</form>
	</div>
	<div data-role="footer" data-position="fixed">
		<div data-role="navbar">
			<ul>
				<li><a href="#home" data-action="announce" data-icon="home">商品</a></li>
			</ul>
		</div><!-- /navbar -->
	</div>
</div>

<div data-role="page" data-theme="b" id="orderStatus">
	<div data-role="header" data-position="fixed" data-theme="b">
		<a href="#order" data-icon="back" data-iconpos="notext">返回</a>
		<h1>訂單狀態</h1>
	</div>
	<div data-role="orderStatus">

		<div data-role="fieldcontain">
			<label for="orderStatus_quantity">訂單數量:</label>
			<span id="orderStatus_quantity"/>
		</div>

		<div data-role="fieldcontain">
			<label for="orderStatus_id">訂單編號:</label>
			<span id="orderStatus_id"/>
		</div>

		<div data-role="fieldcontain">
			<label for="orderStatus_user_username">訂購者姓名:</label>
			<span id="orderStatus_user_username"/>
		</div>

		<div data-role="fieldcontain">
			<label for="orderStatus_user_email">email:</label>
			<span id="orderStatus_user_email"/>
		</div>

		<div data-role="fieldcontain">
			<label for="orderStatus_user_mobile">電話:</label>
			<span id="orderStatus_user_mobile"/>
		</div>

		<div data-role="fieldcontain">
			<label for="orderStatus_user_address">地址:</label>
			<span id="orderStatus_user_address"/>
		</div>
	</div>
</div>


<script type="text/javascript">
// HTML5 Web SQL
/*
var db = openDatabase('mydb', '1.0', 'Test DB', 1 * 1024 * 1024);

db.transaction(function (tx) {
   tx.executeSql('CREATE TABLE IF NOT EXISTS LOGS (id unique, log)');
   tx.executeSql('INSERT INTO LOGS (id, log) VALUES (1, "foobar")');
   tx.executeSql('INSERT INTO LOGS (id, log) VALUES (2, "logmsg")');
});

db.transaction(function(tx) {
	tx.executeSql('CREATE TABLE IF NOT EXISTS PAGES (id unique, slug, title, excerpt, content, date, cover, thumbnail)');
	tx.executeSql('INSERT INTO PAGES (1, "aaa", "bbb", "ccc", "ddd", "eee", "fff", "ggg")');
});
*/
/*
window.onload = function() {
    setTimeout(function(){
        window.scrollTo(0, 1);
    }, 100);
};
$(window).resize(function() {
	window.scrollTo(0, 1);
});
*/
//document.addEventListener("touchmove", function(event){
//    event.preventDefault();
//}, false);

$(function() {

	// Cache all pages
	//cacheAllPages();
	$.get("/product/1", function(data, status){

		var product = data.product;

		$('#product_stockQuantity').text(product.stockQuantity);
		$('#product_name').text(product.name);
		$('#product_descript').text(product.descript);
		$('#product_price').text(product.price);
		$('#product_image').attr("src", product.image);

		for (var i = 1; i < product.stockQuantity+1; i++) {
			$('#order_quantity')
          .append($("<option></option>")
          .attr("value",i)
          .text(i + ' 箱'));
		}
	});

	//callback handler for form submit
	$("#orderStatusQueryForm").submit(function(e)
	{
    var postData = $(this).serializeArray();
    var formURL = $(this).attr("action");
    $.ajax(
    {
      url : formURL,
      type: "POST",
      data : postData,
      success:function(data, textStatus, jqXHR)
      {
        var orderStatus = JSON.parse(data);
				$('#orderStatus_quantity').text(orderStatus.order.quantity);
				$('#orderStatus_id').text(orderStatus.order.id);
				$('#orderStatus_user_username').text(orderStatus.order.user.username);
				$('#orderStatus_user_email').text(orderStatus.order.user.email);
				$('#orderStatus_user_mobile').text(orderStatus.order.user.mobile);
				$('#orderStatus_user_address').text(orderStatus.order.user.address);
				window.location.assign("/index.html#orderStatus")


      },
      error: function(jqXHR, textStatus, errorThrown)
      {
        //if fails
      }
    });
    e.preventDefault(); //STOP default action
	});

	if (true /* window.navigator.standalone == true */) {
		$('#splash').on('swipe', hideSplash);
		setTimeout(hideSplash, 3000);
	}

	//retrieveData();

	$( "a" ).loader({ defaults: true });

	$( document ).ajaxStart(function() {
		$.mobile.loading( "show", {
			text: "Loading...",
			textVisible: true,
			theme: "b",
			html: ""
		});
	});
	$( document ).ajaxComplete(function() {
		$.mobile.loading( "hide" );
	});
	$( document ).ajaxStop(function() {
		$.mobile.loading( "hide" );
	});


	/*
	loadPage('dashboard');

	$('a#btnGoToDashboard').click(function() {
		loadPage('dashboard');
	});

	$('a[data-action=announce]').click(function() {
		retrieveData();
	});
	$('a[data-action=contact]').click(function() {
		loadPage('contact');
	});
	$('a[data-action=about]').click(function() {
		loadPage('about');
	});
    */
});
/*
function cacheAllPages() {
	$.get('wp-json/pages', function(data) {
		db.transaction(function (tx) { console.log('run in');

			for (var i = 0; i < data.length; i++) {
				var d = data[i];console.log(d);
				var id = d.ID, slug = d.slug, title = d.title, excerpt = d.excerpt, content = d.content, modified = d.modified;
				var cover = '', thumbnail = '';
				if (d.featured_image) {
					if (d.featured_image.source) {
						cover = d.featured_image.source;
					}
					if (d.featured_image.attachment_meta) {
						thumbnail = d.featured_image.attachment_meta.sizes.thumbnail.url;
					}
				}
					tx.executeSql('INSERT INTO PAGES (id, slug, title, excerpt, content, modified, cover, thumbnail) VALUES (?, ?, ?, ?, ?, ?, ?, ?)', [id, slug, title, excerpt, content, modified, cover, thumbnail], function(tx, results) {console.log(results); } );
	console.log(id + ', ' + slug);
					tx.executeSql('INSERT INTO PAGES (id, slug) VALUES (?, ?)', [id, slug] );
			}
		});
	});
}
*/
function loadPage(pagename) {
	$.get('wp-json/posts?type[]=page&filter[pagename]='+pagename, function(data) {
		$('#home h1').text(data[0].title);
		var container = $('#home div[data-role=main]');
		container.html(data[0].content);
		container.find('a[href$=".jpg"], a[href$=".jpeg"], a[href$=".png"], a[href$=".gif"]').has('img').each(function() {
			var popupId = 'popup' + new Date().getTime();
			var imgSrc = $(this).attr('href');
			$(this).find('img')./*removeAttr('width').removeAttr('height').removeClass().*/addClass('popphoto');
			$(this).attr('data-rel', 'popup').attr('data-position-to', 'window').attr('data-transition', 'fade');
			$(this).attr('href', '#'+po.upId);
			var popup = $('<div data-role="popup" id="'+popupId+'" data-overlay-theme="b" data-theme="b" data-corners="false"><a href="#" data-rel="back" data-role="button" data-theme="b" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a><img class="popphoto" src="'+imgSrc+'" style="max-height:512px;" /></div>');
			popup.insertAfter($(this));
		});

		//console.log($('a[href$=jpg]'));
		container.trigger('create');
	});
}
function retrieveData() {
	$.get('wp-json/posts?filter[cat]=announce', function(data) {
		var ul = $('<ul/>').data('role', 'listview');
		for (var i = 0; i < data.length; i++) {
			var postDate = new Date(data[i].date);
			var dateStr = postDate.getMonth()+'/'+postDate.getDate();
			var li = $('<li/>');
			var a = $('<a/>');
			a.click(function() {
				$('#viewer h1').text($(this).children('h2').text());
				$('#viewer div[data-role=content]').html($(this).children('.content').html());
			});
			a.attr('href', '#viewer');
			if (data[i].featured_image && data[i].featured_image.source) {
				a.append('<img src="'+data[i].featured_image.source+'" />');
			}
			a.append($('<h2/>').text(data[i].title));
			a.append($('<div/>').html(data[i].excerpt));
			a.append($('<div/>').html(data[i].content).addClass('content').hide());
			//a.append($('<p/>').append(data[i].author.name));
			a.append($('<p class="ui-li-aside">').text(dateStr));
			li.append(a);
			ul.append(li);
		}
		$('#home div[data-role=main]').empty().append(ul);
		ul.listview();
	});
}
function retrievePage() {
	$.get('wp-json/posts?type[]=page&filter[pagename]=about', function(data) {
		$('#viewer h1').text(data[0].title);
		$('#viewer div[data-role=content]').html(data[0].content);
		$.mobile.changePage("#viewer", "slide");
	});
}
function hideSplash() {
	$('#splash').hide();
	$.mobile.changePage("#home", "fade");
}
</script>
</body>
</html>
